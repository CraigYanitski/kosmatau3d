<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>kosmatau3d.models.model &mdash; kosmatau3d 1.0.3 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/readthedocs-custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/documentation_options.js?v=baaebd52"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            kosmatau3d
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Sections:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../properties.html">Clump Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../voxel.html">Voxels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model.html">3D Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../comparison.html">Comparison to Observations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Future Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/kosmatau3d.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../acknowledgements.html">Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">kosmatau3d</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../models.html">kosmatau3d.models</a></li>
      <li class="breadcrumb-item active">kosmatau3d.models.model</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for kosmatau3d.models.model</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">importlib</span> <span class="k">as</span> <span class="nn">il</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">getLogger</span><span class="p">,</span> <span class="n">basicConfig</span><span class="p">,</span> <span class="n">FileHandler</span><span class="p">,</span> <span class="n">Formatter</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">binned_statistic</span>

<span class="kn">from</span> <span class="nn">kosmatau3d.models</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">kosmatau3d.models</span> <span class="kn">import</span> <span class="n">interpolations</span>
<span class="kn">from</span> <span class="nn">kosmatau3d.models</span> <span class="kn">import</span> <span class="n">observations</span>
<span class="kn">from</span> <span class="nn">kosmatau3d.models</span> <span class="kn">import</span> <span class="n">shape</span>  <span class="c1"># import Shape</span>
<span class="kn">from</span> <span class="nn">kosmatau3d.models</span> <span class="kn">import</span> <span class="n">species</span>
<span class="kn">from</span> <span class="nn">.voxel_grid</span> <span class="kn">import</span> <span class="n">VoxelGrid</span>


<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.Model.html#kosmatau3d.models.model.Model">[docs]</a>
<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This is the highest class in the hierarchy of the kosmatau3d simulation.</span>
<span class="sd">    It contains all of the information needed to properly model a PDR.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># PRIVATE</span>
  
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">history_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> 
                 <span class="n">clump_tau_grid_file</span><span class="o">=</span><span class="s1">&#39;clump_tau_LineCenter.dat&#39;</span><span class="p">,</span> 
                 <span class="n">clump_tb_grid_file</span><span class="o">=</span><span class="s1">&#39;clump_Tmb_LineCenter.dat&#39;</span><span class="p">,</span> 
                 <span class="n">clump_taufuv_grid_file</span><span class="o">=</span><span class="s1">&#39;RhoMassAFUV.dat&#39;</span><span class="p">,</span>
                 <span class="n">clump_column_density_file</span><span class="o">=</span><span class="s1">&#39;clumpMeanCols.dat&#39;</span><span class="p">,</span>
                 <span class="n">clump_temperature_file</span><span class="o">=</span><span class="s1">&#39;clumpTemperatures_filled.dat&#39;</span><span class="p">,</span>
                 <span class="n">interclump_tau_grid_file</span><span class="o">=</span><span class="s1">&#39;interclumpTauLineCenter.dat&#39;</span><span class="p">,</span> 
                 <span class="n">interclump_dust_tau_grid_file</span><span class="o">=</span><span class="s1">&#39;interclumpDustTau.dat&#39;</span><span class="p">,</span> 
                 <span class="n">interclump_tb_grid_file</span><span class="o">=</span><span class="s1">&#39;interclumpTmbLineCenter.dat&#39;</span><span class="p">,</span> 
                 <span class="n">interclump_dust_tb_grid_file</span><span class="o">=</span><span class="s1">&#39;interclumpDustSED.dat&#39;</span><span class="p">,</span> 
                 <span class="n">interclump_taufuv_grid_file</span><span class="o">=</span><span class="s1">&#39;interclumpTauFUV.dat&#39;</span><span class="p">,</span>
                 <span class="n">interclump_column_density_file</span><span class="o">=</span><span class="s1">&#39;interclumpMeanCols.dat&#39;</span><span class="p">,</span>
                 <span class="n">interclump_temperature_file</span><span class="o">=</span><span class="s1">&#39;interclumpTemperatures_filled.dat&#39;</span><span class="p">,</span>
                 <span class="n">h2_surface_density_file</span><span class="o">=</span><span class="s1">&#39;h2_surface-density.dat&#39;</span><span class="p">,</span> 
                 <span class="n">hi_surface_density_file</span><span class="o">=</span><span class="s1">&#39;hi_surface-density.dat&#39;</span><span class="p">,</span> 
                 <span class="n">h2_scale_height_file</span><span class="o">=</span><span class="s1">&#39;h2_scale-height.dat&#39;</span><span class="p">,</span> 
                 <span class="n">hi_scale_height_file</span><span class="o">=</span><span class="s1">&#39;hi_scale-height.dat&#39;</span><span class="p">,</span> 
                 <span class="n">h_number_density_file</span><span class="o">=</span><span class="s1">&#39;h_number-density.dat&#39;</span><span class="p">,</span> 
                 <span class="n">fuv_file</span><span class="o">=</span><span class="s1">&#39;galactic_FUV_complete.dat&#39;</span><span class="p">,</span> 
                 <span class="n">l_range</span><span class="o">=</span><span class="p">(</span><span class="mi">912</span><span class="p">,</span> <span class="mi">2066</span><span class="p">),</span> <span class="n">average_fuv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_gc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mhi_gc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mh2_gc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">r_gc</span><span class="o">=</span><span class="mi">4400</span><span class="p">,</span> 
                 <span class="n">like_clumps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">all_full</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                 <span class="n">velocity_file</span><span class="o">=</span><span class="s1">&#39;rot_milki2018_14.dat&#39;</span><span class="p">,</span> <span class="n">disp_core</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">r_core</span><span class="o">=</span><span class="mi">4400</span><span class="p">,</span> <span class="n">disp_gmc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                 <span class="n">abundances</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ELECTR&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H2&#39;</span><span class="p">,</span> <span class="s1">&#39;H+&#39;</span><span class="p">],</span> 
                 <span class="n">transitions</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">dust</span><span class="o">=</span><span class="s1">&#39;molecular&#39;</span><span class="p">,</span> <span class="n">velocity_range</span><span class="o">=</span><span class="p">(),</span> <span class="n">velocity_number</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">clump_mass_range</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)),</span> <span class="n">clump_mass_number</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">clump_n_max</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> 
                 <span class="n">ensemble_mass_factor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">interclump_idx</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="n">interclump_wnm_idx</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> 
                 <span class="n">interclump_hi_ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">interclump_wnm_ratio</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                 <span class="n">interclump_wnm_log_fuv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interclump_f_fuv_wnm</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> 
                 <span class="n">interclump_fillingfactor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interclump_density</span><span class="o">=</span><span class="mi">1911</span><span class="p">,</span> 
                 <span class="n">interclump_log_fuv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clump_log_fuv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">hi_mass_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">h2_mass_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fuv_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">density_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">global_uv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
                 <span class="n">r_cmz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zeta_cmz</span><span class="o">=</span><span class="mf">1e-14</span><span class="p">,</span> <span class="n">zeta_sol</span><span class="o">=</span><span class="mf">2e-16</span><span class="p">,</span> <span class="n">new_grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suggested_calc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">dilled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The `Model()` class, which is used to create large three-dimensional PDR models and as</span>
<span class="sd">        well as a synthetic observation. For large models, it is best to stream the voxel</span>
<span class="sd">        data to the hard disk and avoid keeping the data in memory.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">clump_mass_range</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;&lt;&lt;ERROR&gt;&gt; Define mass sets in argument.&#39;</span><span class="p">)</span>
            <span class="c1"># sys.exit()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">velocity_range</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;&lt;&lt;ERROR&gt;&gt; Define observing velocities in argument.&#39;</span><span class="p">)</span>
            <span class="c1"># sys.exit()</span>
        
        <span class="c1"># this just adds a label to the type of model being created. ie &#39;disk&#39;, &#39;bar&#39;, &#39;sphere&#39;, etc.</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">model_type</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">voxel_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">HISTORYPATH</span> <span class="o">=</span> <span class="n">history_path</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="n">folder</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">change_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

        <span class="c1"># Clump properties</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">change_velocity_range</span><span class="p">(</span><span class="n">velocity_range</span><span class="p">)</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">change_velocity_number</span><span class="p">(</span><span class="n">velocity_number</span><span class="p">)</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">add_clumps</span><span class="p">(</span><span class="n">mass_range</span><span class="o">=</span><span class="n">clump_mass_range</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">clump_mass_number</span><span class="p">,</span> <span class="n">n_max</span><span class="o">=</span><span class="n">clump_n_max</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">set_interclump_ensemble</span><span class="p">(</span><span class="n">interclump_idx</span><span class="p">)</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">set_interclump_wnm</span><span class="p">(</span><span class="n">interclump_wnm_idx</span><span class="p">)</span>
        
        <span class="c1"># Factors</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">ensemble_mass_factor</span> <span class="o">=</span> <span class="n">ensemble_mass_factor</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">hi_mass_factor</span> <span class="o">=</span> <span class="n">hi_mass_factor</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">h2_mass_factor</span> <span class="o">=</span> <span class="n">h2_mass_factor</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">interclump_idx</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">interclump_hi_ratio</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">interclump_hi_ratio</span> <span class="o">=</span> <span class="n">interclump_hi_ratio</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">interclump_wnm_idx</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">interclump_wnm_ratio</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">interclump_wnm_ratio</span> <span class="o">=</span> <span class="n">interclump_wnm_ratio</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">interclump_fillingfactor</span> <span class="o">=</span> <span class="n">interclump_fillingfactor</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">density_factor</span> <span class="o">=</span> <span class="n">density_factor</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">interclump_density</span> <span class="o">=</span> <span class="n">interclump_density</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">fuv_factor</span> <span class="o">=</span> <span class="n">fuv_factor</span>
        <span class="c1"># constants.globalUV = globalUV</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">clump_log_fuv</span> <span class="o">=</span> <span class="n">clump_log_fuv</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">interclump_log_fuv</span> <span class="o">=</span> <span class="n">interclump_log_fuv</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">interclump_wnm_log_fuv</span> <span class="o">=</span> <span class="n">interclump_wnm_log_fuv</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">interclump_f_fuv_wnm</span> <span class="o">=</span> <span class="n">interclump_f_fuv_wnm</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">r_cmz</span> <span class="o">=</span> <span class="n">r_cmz</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">zeta_cmz</span> <span class="o">=</span> <span class="n">zeta_cmz</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">zeta_sol</span> <span class="o">=</span> <span class="n">zeta_sol</span>
        
        <span class="c1"># Read grid &amp; input data, specify transitions, and interpolate</span>
        <span class="k">if</span> <span class="s1">&#39;ELECTR&#39;</span> <span class="ow">in</span> <span class="n">abundances</span><span class="p">:</span>
            <span class="n">abundances</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;ELECTR&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;H&#39;</span> <span class="ow">in</span> <span class="n">abundances</span><span class="p">:</span>
            <span class="n">abundances</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;H2&#39;</span> <span class="ow">in</span> <span class="n">abundances</span><span class="p">:</span>
            <span class="n">abundances</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;H2&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;H+&#39;</span> <span class="ow">in</span> <span class="n">abundances</span><span class="p">:</span>
            <span class="n">abundances</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;H+&#39;</span><span class="p">)</span>
        <span class="n">abun</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ELECTR&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H2&#39;</span><span class="p">,</span> <span class="s1">&#39;H+&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">abundances</span><span class="p">:</span>
            <span class="n">abun</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">abundances</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">abun</span><span class="p">)</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">clump_species_tb_grid_file</span> <span class="o">=</span> <span class="n">clump_tb_grid_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">clump_species_tau_grid_file</span> <span class="o">=</span> <span class="n">clump_tau_grid_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">clump_dust_tb_grid_file</span> <span class="o">=</span> <span class="n">clump_tb_grid_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">clump_dust_tau_grid_file</span> <span class="o">=</span> <span class="n">clump_tau_grid_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">clump_taufuv_grid_file</span> <span class="o">=</span> <span class="n">clump_taufuv_grid_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">clump_column_density_file</span> <span class="o">=</span> <span class="n">clump_column_density_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">clump_temperature_file</span> <span class="o">=</span> <span class="n">clump_temperature_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">interclump_species_tb_grid_file</span> <span class="o">=</span> <span class="n">interclump_tb_grid_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">interclump_species_tau_grid_file</span> <span class="o">=</span> <span class="n">interclump_tau_grid_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">interclump_dust_tb_grid_file</span> <span class="o">=</span> <span class="n">interclump_tb_grid_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">interclump_dust_tau_grid_file</span> <span class="o">=</span> <span class="n">interclump_tau_grid_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">interclump_taufuv_grid_file</span> <span class="o">=</span> <span class="n">interclump_taufuv_grid_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">interclump_column_density_file</span> <span class="o">=</span> <span class="n">interclump_column_density_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">interclump_temperature_file</span> <span class="o">=</span> <span class="n">interclump_temperature_file</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">initialise_grid</span><span class="p">(</span><span class="n">clump_tau_grid_file</span><span class="o">=</span><span class="n">clump_tau_grid_file</span><span class="p">,</span> 
                                             <span class="n">interclump_tau_grid_file</span><span class="o">=</span><span class="n">interclump_tau_grid_file</span><span class="p">,</span> 
                                             <span class="n">interclump_dust_tau_grid_file</span><span class="o">=</span><span class="n">interclump_dust_tau_grid_file</span><span class="p">,</span> 
                                             <span class="n">clump_tb_grid_file</span><span class="o">=</span><span class="n">clump_tb_grid_file</span><span class="p">,</span> 
                                             <span class="n">interclump_tb_grid_file</span><span class="o">=</span><span class="n">interclump_tb_grid_file</span><span class="p">,</span> 
                                             <span class="n">interclump_dust_tb_grid_file</span><span class="o">=</span><span class="n">interclump_dust_tb_grid_file</span><span class="p">,</span> 
                                             <span class="n">clump_taufuv_grid_file</span><span class="o">=</span><span class="n">clump_taufuv_grid_file</span><span class="p">,</span> 
                                             <span class="n">interclump_taufuv_grid_file</span><span class="o">=</span><span class="n">interclump_taufuv_grid_file</span><span class="p">,</span>
                                             <span class="n">clump_column_density_file</span><span class="o">=</span><span class="n">clump_column_density_file</span><span class="p">,</span>
                                             <span class="n">interclump_column_density_file</span><span class="o">=</span><span class="n">interclump_column_density_file</span><span class="p">,</span>
                                             <span class="n">clump_temperature_file</span><span class="o">=</span><span class="n">clump_temperature_file</span><span class="p">,</span>
                                             <span class="n">interclump_temperature_file</span><span class="o">=</span><span class="n">interclump_temperature_file</span><span class="p">)</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">h2_surface_density_file</span> <span class="o">=</span> <span class="n">h2_surface_density_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">hi_surface_density_file</span> <span class="o">=</span> <span class="n">hi_surface_density_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">h2_scale_height_file</span> <span class="o">=</span> <span class="n">h2_scale_height_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">hi_scale_height_file</span> <span class="o">=</span> <span class="n">hi_scale_height_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">h_number_density_file</span> <span class="o">=</span> <span class="n">h_number_density_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">fuv_file</span> <span class="o">=</span> <span class="n">fuv_file</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">velocity_file</span> <span class="o">=</span> <span class="n">velocity_file</span>
        <span class="n">observations</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">initialise_input</span><span class="p">(</span><span class="n">h2_surface_density_file</span><span class="o">=</span><span class="n">h2_surface_density_file</span><span class="p">,</span> 
                                              <span class="n">hi_surface_density_file</span><span class="o">=</span><span class="n">hi_surface_density_file</span><span class="p">,</span> 
                                              <span class="n">h2_scale_height_file</span><span class="o">=</span><span class="n">h2_scale_height_file</span><span class="p">,</span> 
                                              <span class="n">hi_scale_height_file</span><span class="o">=</span><span class="n">hi_scale_height_file</span><span class="p">,</span> 
                                              <span class="n">h_number_density_file</span><span class="o">=</span><span class="n">h_number_density_file</span><span class="p">,</span> 
                                              <span class="n">fuv_file</span><span class="o">=</span><span class="n">fuv_file</span><span class="p">,</span>
                                              <span class="n">velocity_file</span><span class="o">=</span><span class="n">velocity_file</span><span class="p">)</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">dust</span> <span class="o">=</span> <span class="n">dust</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__add_transitions</span><span class="p">(</span><span class="n">transitions</span><span class="p">)</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">change_dust_wavelengths</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">dust</span><span class="p">)</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">fuv_scale_gc</span> <span class="o">=</span> <span class="n">scale_gc</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">mhi_scale_gc</span> <span class="o">=</span> <span class="n">mhi_gc</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">mh2_scale_gc</span> <span class="o">=</span> <span class="n">mh2_gc</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">r_gc</span> <span class="o">=</span> <span class="n">r_gc</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">disp_gc</span> <span class="o">=</span> <span class="n">disp_core</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">disp_r_gc</span> <span class="o">=</span> <span class="n">r_core</span>
        <span class="k">if</span> <span class="n">disp_gmc</span><span class="p">:</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">disp_gmc</span> <span class="o">=</span> <span class="n">disp_gmc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">disp_gmc</span> <span class="o">=</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">constants</span><span class="o">.</span><span class="n">voxel_size</span><span class="o">**</span><span class="mf">0.38</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">interpolations</span><span class="o">.</span><span class="n">initialised</span> <span class="ow">or</span> <span class="n">new_grid</span><span class="p">:</span>
            <span class="n">interpolations</span><span class="o">.</span><span class="n">initialise_grid</span><span class="p">(</span><span class="n">dilled</span><span class="o">=</span><span class="n">dilled</span><span class="p">)</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">average_fuv</span> <span class="o">=</span> <span class="n">average_fuv</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">l_range</span> <span class="o">=</span> <span class="n">l_range</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">like_clumps</span> <span class="o">=</span> <span class="n">like_clumps</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">all_full</span> <span class="o">=</span> <span class="n">all_full</span>
            <span class="n">interpolations</span><span class="o">.</span><span class="n">initialise_model</span><span class="p">(</span><span class="n">l_range</span><span class="o">=</span><span class="n">l_range</span><span class="p">,</span> <span class="n">average_fuv</span><span class="o">=</span><span class="n">average_fuv</span><span class="p">,</span> 
                                            <span class="n">all_full</span><span class="o">=</span><span class="n">all_full</span><span class="p">,</span> <span class="n">like_clumps</span><span class="o">=</span><span class="n">like_clumps</span><span class="p">)</span>

        <span class="c1"># Initialise logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">()</span>

        <span class="c1"># Shape() object to create the parameters for the grid of voxels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">Shape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">modelType</span><span class="o">=</span><span class="n">model_type</span><span class="p">)</span>
        <span class="c1"># VoxelGrid() object to build the model and calculate the emission</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__grid</span> <span class="o">=</span> <span class="n">VoxelGrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__shape</span><span class="p">,</span> <span class="n">suggested_calc</span><span class="o">=</span><span class="n">suggested_calc</span><span class="p">)</span>
        <span class="c1"># Orientation() object to change the viewing angle and expected spectra</span>
        <span class="c1"># self.__orientation = Orientation(self.__shape.getDimensions())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__speciesNames</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># this is a list of the species names for easy printout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__timed</span> <span class="o">=</span> <span class="n">timed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__intensityMap</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mapPositions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span>
  
    <span class="k">def</span> <span class="nf">__add_transitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species_transition</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add transition(s) to the list of transitions in model output.</span>
<span class="sd">        Note that this is for the transitions used in radiative transfer.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">species</span><span class="o">.</span><span class="n">add_transitions</span><span class="p">(</span><span class="n">species_transition</span><span class="p">)</span>
        <span class="n">species</span><span class="o">.</span><span class="n">add_transitions</span><span class="p">(</span><span class="n">species_transition</span><span class="p">,</span> <span class="n">interclump</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span>
  
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Print information of the model. This will become useful for smaller</span>
<span class="sd">        models that can be kept in memory.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">printout</span> <span class="o">=</span> <span class="s1">&#39;A </span><span class="si">{}</span><span class="s1"> model of </span><span class="si">{}</span><span class="s1"> voxels&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGrid</span><span class="p">()</span><span class="o">.</span><span class="n">getVoxelNumber</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__verbose</span><span class="p">:</span>
            <span class="n">printout</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  arranged in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__shape</span><span class="o">.</span><span class="n">getDimensions</span><span class="p">())</span>
            <span class="n">printout</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Considering </span><span class="si">{}</span><span class="s1"> species:</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_names</span><span class="p">),</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">__molecules</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">__dust</span><span class="p">)</span>
        <span class="n">emission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">totalEmission</span><span class="p">()</span>
        <span class="n">printout</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Total intensity: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">Total optical depth: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">emission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
                                                                              <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">emission</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">printout</span>
  
    <span class="c1"># PUBLIC</span>
  
<div class="viewcode-block" id="Model.getType">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.Model.html#kosmatau3d.models.model.Model.getType">[docs]</a>
    <span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return type of model. Currently only the &#39;disk&#39; models are working.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">constants</span><span class="o">.</span><span class="n">type</span></div>

  
<div class="viewcode-block" id="Model.getShape">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.Model.html#kosmatau3d.models.model.Model.getShape">[docs]</a>
    <span class="k">def</span> <span class="nf">getShape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return `Shape` instance of model. This will soon be moved from a class to a subpackage.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span></div>

  
<div class="viewcode-block" id="Model.getGrid">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.Model.html#kosmatau3d.models.model.Model.getGrid">[docs]</a>
    <span class="k">def</span> <span class="nf">getGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return `voxelGrid` instance of the model. It contains all of the information regarding</span>
<span class="sd">        voxels used in the model.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__grid</span></div>

  
<div class="viewcode-block" id="Model.getOrientation">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.Model.html#kosmatau3d.models.model.Model.getOrientation">[docs]</a>
    <span class="k">def</span> <span class="nf">getOrientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return orientation of model. This is important for integrating the radiative </span>
<span class="sd">        transfer equation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__orientation</span></div>

  
    <span class="c1"># def getObservations(self):</span>
    <span class="c1">#   return self.__observations</span>
  
<div class="viewcode-block" id="Model.getSpecies">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.Model.html#kosmatau3d.models.model.Model.getSpecies">[docs]</a>
    <span class="k">def</span> <span class="nf">getSpecies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return list of species names.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">species</span><span class="o">.</span><span class="n">species_names</span></div>

  
<div class="viewcode-block" id="Model.getSpeciesNames">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.Model.html#kosmatau3d.models.model.Model.getSpeciesNames">[docs]</a>
    <span class="k">def</span> <span class="nf">getSpeciesNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Same as `getSpecies()`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">species</span><span class="o">.</span><span class="n">species_names</span></div>

  
    <span class="c1"># def reloadModules(self):</span>
    <span class="c1">#   il.reload(shape)</span>
    <span class="c1">#   il.reload(voxelgrid)</span>
    <span class="c1">#   il.reload(orientation)</span>
    <span class="c1">#   il.reload(observations)</span>
    <span class="c1">#   il.reload(molecules)</span>
    <span class="c1">#   il.reload(dust)</span>
    <span class="c1">#   self.__shape.reloadModules()</span>
    <span class="c1">#   self.__grid.reloadModules()</span>
    <span class="c1">#   #self.__observations.reloadModules()</span>
    <span class="c1">#   #self.__orientation.reloadModules()</span>
    <span class="c1">#   self.__molecules.reloadModules()</span>
    <span class="c1">#   self.__dust.reloadModules()</span>
    <span class="c1">#   return</span>
  
<div class="viewcode-block" id="Model.calculateModel">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.Model.html#kosmatau3d.models.model.Model.calculateModel">[docs]</a>
    <span class="k">def</span> <span class="nf">calculateModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compute voxel the emissivity and absorption spectra for each voxel.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Point logger to file</span>
        <span class="n">format_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="si">%(levelname)s</span><span class="s1"> [</span><span class="si">%(name)s</span><span class="s1">]: </span><span class="si">%(message)s</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">HISTORYPATH</span> <span class="o">+</span> <span class="n">constants</span><span class="o">.</span><span class="n">directory</span> <span class="o">+</span> <span class="n">constants</span><span class="o">.</span><span class="n">history</span> <span class="o">+</span> <span class="s1">&#39;log.txt&#39;</span>
        <span class="n">filehandler</span> <span class="o">=</span> <span class="n">FileHandler</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__debug</span><span class="p">:</span>
            <span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">format_str</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
            <span class="c1">#self.__logger.setLevel(&#39;DEBUG&#39;)</span>
            <span class="c1">#filehandler.setLevel(&#39;DEBUG&#39;)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__verbose</span><span class="p">:</span>
            <span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">format_str</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
            <span class="c1">#self.__logger.setLevel(&#39;INFO&#39;)</span>
            <span class="c1">#filehandler.setLevel(&#39;INFO&#39;)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">format_str</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="c1">#self.__logger.setLevel(&#39;WARNING&#39;)</span>
            <span class="c1">#filehandler.setLevel(&#39;WARNING&#39;)</span>
        <span class="c1">#filehandler.setformatter(Formatter(format_str))</span>
        <span class="c1">#self.__logger.addHandler(filehandler)</span>

        <span class="c1"># Calculate emission</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">calculateEmission</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span></div>

  
<div class="viewcode-block" id="Model.writeEmission">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.Model.html#kosmatau3d.models.model.Model.writeEmission">[docs]</a>
    <span class="k">def</span> <span class="nf">writeEmission</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Write voxel spectra to hard disk. This is only useful when keeping </span>
<span class="sd">        the model in memory.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">writeEmission</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__verbose</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__debug</span><span class="p">)</span>
        <span class="k">return</span></div>

  
<div class="viewcode-block" id="Model.getIntensityMap">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.Model.html#kosmatau3d.models.model.Model.getIntensityMap">[docs]</a>
    <span class="k">def</span> <span class="nf">getIntensityMap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return synthetic intensity. This is only useful when keeping the</span>
<span class="sd">        model in memory.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mapPositions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intensityMap</span><span class="p">)</span></div>

  
<div class="viewcode-block" id="Model.printIntensityMap">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.Model.html#kosmatau3d.models.model.Model.printIntensityMap">[docs]</a>
    <span class="k">def</span> <span class="nf">printIntensityMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Print synthetic intensity data to screen.</span>
<span class="sd">        &#39;&#39;&#39;</span>
  
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__species</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getMolecules</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__species</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getDust</span><span class="p">())</span>
    
        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
    
            <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mapPositions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intensityMap</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
      
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;At position x=</span><span class="si">{}</span><span class="s1"> y=</span><span class="si">{}</span><span class="s1">, the intensity is&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">intensity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
      
                <span class="n">i</span> <span class="o">=</span> <span class="n">intensity</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1"> centered at </span><span class="si">{}</span><span class="s1"> km/s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__speciesNames</span><span class="p">[</span><span class="n">element</span><span class="p">],</span>
                                                          <span class="n">intensity</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="n">intensity</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()],</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">__constants</span><span class="o">.</span><span class="n">velocityBins</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            
            <span class="nb">print</span><span class="p">()</span>
    
        <span class="k">else</span><span class="p">:</span>
          
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mapPositions</span><span class="p">)):</span>
            
                <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mapPositions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intensityMap</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
              
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;At position x=</span><span class="si">{}</span><span class="s1"> y=</span><span class="si">{}</span><span class="s1">, the intensity is&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
              
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">intensity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
              
                    <span class="n">i</span> <span class="o">=</span> <span class="n">intensity</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1"> centered at </span><span class="si">{}</span><span class="s1"> km/s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__speciesNames</span><span class="p">[</span><span class="n">element</span><span class="p">],</span>
                                                              <span class="n">intensity</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="n">intensity</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()],</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">__constants</span><span class="o">.</span><span class="n">velocityBins</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
              
                <span class="nb">print</span><span class="p">()</span>
        
        <span class="k">return</span></div>

      
<div class="viewcode-block" id="Model.plotModel">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.Model.html#kosmatau3d.models.model.Model.plotModel">[docs]</a>
    <span class="k">def</span> <span class="nf">plotModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="s1">&#39;total intensity&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Outdated method to plot model information. Might be useful when</span>
<span class="sd">        keeping model data in memory.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">getVoxelPositions</span><span class="p">()</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="n">positions</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">positions</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;total intensity&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">totalEmission</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">totalEmission</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I \ (\chi)$&#39;</span>
        <span class="k">elif</span> <span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;total optical depth&#39;</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">totalEmission</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\tau$&#39;</span>
        <span class="k">elif</span> <span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;clump intensity&#39;</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">clumpEmission</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I \ (\chi)$&#39;</span>
        <span class="k">elif</span> <span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;clump optical depth&#39;</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">clumpEmission</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\tau$&#39;</span>
        <span class="k">elif</span> <span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;interclump intensity&#39;</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">interclumpEmission</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I \ (\chi)$&#39;</span>
        <span class="k">elif</span> <span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;interclump optical depth&#39;</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">interclumpEmission</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\tau$&#39;</span>
        <span class="k">elif</span> <span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;FUV&#39;</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">getFUV</span><span class="p">())</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$FUV \ (\chi)$&#39;</span>
        <span class="k">elif</span> <span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;Afuv&#39;</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">getAfuv</span><span class="p">())</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\tau_</span><span class="si">{FUV}</span><span class="s1">$&#39;</span>
        <span class="k">elif</span> <span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;velocity&#39;</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__grid</span><span class="o">.</span><span class="n">getVelocity</span><span class="p">())</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_</span><span class="si">{rot}</span><span class="s1"> \ (\frac</span><span class="si">{km}{s}</span><span class="s1">)$&#39;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">positions</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">positions</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                           <span class="n">c</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">27</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PDR Emission within the Milky Way&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X (pc)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y (pc)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z (pc)&#39;</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span></div>

  
    <span class="k">def</span> <span class="nf">hdu_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
    
        <span class="n">header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span>
        
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;SIMPLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;conforms to FITS standard&#39;</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;BITPIX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;element size&#39;</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAXIS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;number of axes&#39;</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;EXTEND&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dim</span><span class="p">)):</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAXIS</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
        <span class="c1"># header[&#39;NAXIS1&#39;] = self.__constants.velocityBins.size#emission[0].data[0,0,0,:].size</span>
        <span class="c1"># header[&#39;NAXIS2&#39;] = len(self.__species[0].getMolecules())+len(self.__species[1].getDust())</span>
        <span class="c1"># header[&#39;NAXIS3&#39;] = 2#emission[0].data[:,0,0,0].size</span>
        <span class="c1"># header[&#39;NAXIS4&#39;] = self.__voxelNumber#emission[0].data[0,:,0,0].size</span>
      
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;UNITS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">units</span>
        
        <span class="k">if</span> <span class="s1">&#39;.fits&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">HISTORYPATH</span> <span class="o">+</span> <span class="n">constants</span><span class="o">.</span><span class="n">directory</span> <span class="o">+</span> \
                       <span class="s1">&#39;r</span><span class="si">{}</span><span class="s1">_n</span><span class="si">{}</span><span class="s1">/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span><span class="o">.</span><span class="n">voxelNumber</span><span class="p">())</span> <span class="o">+</span> \
                       <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.fits&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">HISTORYPATH</span> <span class="o">+</span> <span class="n">constants</span><span class="o">.</span><span class="n">directory</span> <span class="o">+</span> <span class="n">filename</span>
        
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        
        <span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
        <span class="n">hdu</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">return</span></div>



<div class="viewcode-block" id="SyntheticModel">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel">[docs]</a>
<span class="k">class</span> <span class="nc">SyntheticModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This is a class to load individual `kosmatau3d` models. This in merely for</span>
<span class="sd">    the convenience of examining the model information in a consistent manner.</span>
<span class="sd">    There is an optional argument when initialising to set a base directory, which</span>
<span class="sd">    makes it easier to load multiple models in succession. Due to the complexity</span>
<span class="sd">    of the `kosmatau3d` models, it is not recommended to load multiple models at</span>
<span class="sd">    the same time.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This initialises the object along with the base directory.</span>
<span class="sd">        The owned objects of `base_dir` and `files` are created.</span>
<span class="sd">        `files` can be modified again when loading a model, but for now it</span>
<span class="sd">        has the default filenames created with `kosmatau3d`.</span>

<span class="sd">        :param base_dir: the base directory to use when loading models. Default: `&#39;&#39;`.</span>


<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">base_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_model</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_map</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;intensity&#39;</span><span class="p">:</span> <span class="s1">&#39;synthetic_intensity&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;optical_depth&#39;</span><span class="p">:</span> <span class="s1">&#39;synthetic_optical_depth&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;hi_intensity&#39;</span><span class="p">:</span> <span class="s1">&#39;synthetic_hi_intensity&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;hi_optical_depth&#39;</span><span class="p">:</span> <span class="s1">&#39;synthetic_hi_optical_depth&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;f_vox&#39;</span><span class="p">:</span> <span class="s1">&#39;voxel-filling_factor&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;species_number&#39;</span><span class="p">:</span> <span class="s1">&#39;species_number&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;t_gas&#39;</span><span class="p">:</span> <span class="s1">&#39;voxel_t_gas&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;t_dust&#39;</span><span class="p">:</span> <span class="s1">&#39;voxel_t_dust&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;dust_absorption&#39;</span><span class="p">:</span> <span class="s1">&#39;dust_absorption&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;dust_emissivity&#39;</span><span class="p">:</span> <span class="s1">&#39;dust_emissivity&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;species_absorption&#39;</span><span class="p">:</span> <span class="s1">&#39;species_absorption&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;hi_emissivity&#39;</span><span class="p">:</span> <span class="s1">&#39;hi_emissivity&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;hi_absorption&#39;</span><span class="p">:</span> <span class="s1">&#39;hi_absorption&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;species_emissivity&#39;</span><span class="p">:</span> <span class="s1">&#39;species_emissivity&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;clump_number&#39;</span><span class="p">:</span> <span class="s1">&#39;clump_number&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;clump_radius&#39;</span><span class="p">:</span> <span class="s1">&#39;clump_radius&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="s1">&#39;voxel_density&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;ensemble_dispersion&#39;</span><span class="p">:</span> <span class="s1">&#39;voxel_ensemble_dispersion&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;ensemble_mass&#39;</span><span class="p">:</span> <span class="s1">&#39;voxel_ensemble_mass&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;hi_mass&#39;</span><span class="p">:</span> <span class="s1">&#39;voxel_hi_mass&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;h2_mass&#39;</span><span class="p">:</span> <span class="s1">&#39;voxel_h2_mass&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;fuv_absorption&#39;</span><span class="p">:</span> <span class="s1">&#39;voxel_FUVabsorption&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;fuv&#39;</span><span class="p">:</span> <span class="s1">&#39;voxel_fuv&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="s1">&#39;voxel_position&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;velocity&#39;</span><span class="p">:</span> <span class="s1">&#39;voxel_velocity&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;los_count&#39;</span><span class="p">:</span> <span class="s1">&#39;sightlines&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;log&#39;</span><span class="p">:</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="p">}</span>
        
        <span class="c1"># initialise files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensity_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_intensity_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_file</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">species_number_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dust_absorption_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dust_optical_depth_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_absorption_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_emissivity_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_absorption_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_file</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">t_gas_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_dust_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_vox_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clump_number_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clump_radius_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_dispersion_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_mass_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h2_mass_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuv_absorption_dispersion_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuv_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocity_file</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Open and return model data if file exists, otherwise return NaN.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.fits&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_files</span><span class="p">:</span>
            <span class="n">file_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.fits&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_files</span><span class="p">:</span>
            <span class="n">file_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_files</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">file_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">file_data</span>

    <span class="k">def</span> <span class="nf">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdul</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Verify and return data in an HDUList, otherwise return NaN.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdul</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">hdul</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">hdul</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<div class="viewcode-block" id="SyntheticModel.close_files">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.close_files">[docs]</a>
    <span class="k">def</span> <span class="nf">close_files</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Close any open FITS files.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intensity_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">intensity_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_intensity_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hi_intensity_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_number_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">species_number_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust_absorption_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dust_absorption_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust_optical_depth_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dust_optical_depth_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_absorption_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">species_absorption_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_emissivity_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">species_emissivity_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_absorption_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hi_absorption_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_gas_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t_gas_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_dust_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t_dust_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_vox_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">f_vox_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clump_number_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clump_number_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clump_radius_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clump_radius_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">density_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">density_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_dispersion_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_dispersion_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_mass_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hi_mass_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h2_mass_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h2_mass_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuv_absorption_dispersion_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fuv_absorption_dispersion_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuv_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fuv_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">position_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">velocity_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span></div>


<div class="viewcode-block" id="SyntheticModel.change_files">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.change_files">[docs]</a>
    <span class="k">def</span> <span class="nf">change_files</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Change the specified filenames.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            
            <span class="c1"># # Ensure model path exists</span>
            <span class="c1"># if os.path.exists(self.base_dir + kwargs[&#39;directory&#39;]):</span>
            <span class="c1">#     pass</span>
            <span class="c1"># else:</span>
            <span class="c1">#     print(f&#39;Directory {self.base_dir + kwargs[&quot;directory&quot;]} is not valid!! Check to see &#39;</span>
            <span class="c1">#           + &#39;if `base_dir` was set when initialising or if the specified directory was correct.&#39;)</span>
            <span class="c1">#     return</span>
            
            <span class="c1"># Update model file information</span>
            <span class="n">kwarg_keys</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="c1"># self.files[&#39;directory&#39;] = kwargs[&#39;directory&#39;]</span>
            <span class="k">if</span> <span class="s1">&#39;intensity&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;optical_depth&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;optical_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;optical_depth&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;hi_intensity&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;hi_intensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hi_intensity&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;hi_optical_depth&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;hi_optical_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hi_optical_depth&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;f_vox&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;f_vox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;f_vox&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;species_number&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;species_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;species_number&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;t_gas&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;t_gas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;t_gas&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;t_dust&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;t_dust&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;t_dust&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;dust_absorption&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;dust_absorption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dust_absorption&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;dust_emissivity&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;dust_emissivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dust_emissivity&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;species_absorption&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;species_absorption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;species_absorption&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;species_emissivity&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;species_emissivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;species_emissivity&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;hi_absorption&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;hi_absorption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hi_absorption&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;hi_emissivity&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;hi_emissivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hi_emissivity&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;clump_number&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;clump_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;clump_number&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;clump_radius&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;clump_radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;clump_radius&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;density&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;ensemble_dispersion&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;ensemble_dispersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ensemble_dispersion&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;ensemble_mass&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;ensemble_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ensemble_mass&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;hi_mass&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;hi_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hi_mass&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;h2_mass&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;h2_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;h2_mass&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;fuv_absorption&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;fuv_absorption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fuv_absorption&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;fuv&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;fuv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fuv&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;position&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;velocity&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;velocity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;velocity&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;los_count&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;los_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;los_count&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;log&#39;</span> <span class="ow">in</span> <span class="n">kwarg_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span></div>


    <span class="nd">@change_files</span>
    <span class="nd">@close_files</span>
    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">map_units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Load all of the data for one model. Any additional information such as </span>
<span class="sd">        observing velocities, latitude, and longitude are computed as well.</span>

<span class="sd">        **Note** that this can be quite computationally expensive. It is not recommended </span>
<span class="sd">        to load multiple models at the same time.</span>

<span class="sd">        :param directory: The directory of all of the model. Note that this is </span>
<span class="sd">                          appended to `self.base_dir`.</span>
<span class="sd">        :param kwargs: optional kwargs to modify the model files used (specified in </span>
<span class="sd">                       `self.files`).</span>


<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="c1"># Ensure model path exists</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span><span class="p">):</span>
        <span class="c1">#if os.path.exists(self.base_dir + directory + self.files[&#39;intensity&#39;] + &#39;.fits&#39;):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;directory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">directory</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">+</span> <span class="n">directory</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Directory </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">directory</span><span class="si">}</span><span class="s1"> is not valid!! Check &#39;</span>
                                    <span class="o">+</span><span class="s1">&#39;to see if `base_dir` was set when initialising or if the &#39;</span>
                                    <span class="o">+</span><span class="s1">&#39;specified directory was correct.&#39;</span><span class="p">)</span>

        <span class="c1"># # Update model file information</span>
        <span class="c1"># kwarg_keys = kwargs.keys()</span>
        <span class="c1"># if &#39;intensity&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;intensity&#39;] = kwargs[&#39;intensity&#39;]</span>
        <span class="c1"># if &#39;optical_depth&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;optical_depth&#39;] = kwargs[&#39;optical_depth&#39;]</span>
        <span class="c1"># if &#39;dust_absorption&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;dust_absorption&#39;] = kwargs[&#39;dust_absorption&#39;]</span>
        <span class="c1"># if &#39;dust_emissivity&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;dust_emissivity&#39;] = kwargs[&#39;dust_emissivity&#39;]</span>
        <span class="c1"># if &#39;species_absorption&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;species_absorption&#39;] = kwargs[&#39;species_absorption&#39;]</span>
        <span class="c1"># if &#39;species_emissivity&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;species_emissivity&#39;] = kwargs[&#39;species_emissivity&#39;]</span>
        <span class="c1"># if &#39;density&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;density&#39;] = kwargs[&#39;density&#39;]</span>
        <span class="c1"># if &#39;ensemble_dispersion&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;ensemble_dispersion&#39;] = kwargs[&#39;ensemble_dispersion&#39;]</span>
        <span class="c1"># if &#39;ensemble_mass&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;ensemble_mass&#39;] = kwargs[&#39;ensemble_mass&#39;]</span>
        <span class="c1"># if &#39;fuv_absorption&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;fuv_absorption&#39;] = kwargs[&#39;fuv_absorption&#39;]</span>
        <span class="c1"># if &#39;fuv&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;fuv&#39;] = kwargs[&#39;fuv&#39;]</span>
        <span class="c1"># if &#39;position&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;position&#39;] = kwargs[&#39;position&#39;]</span>
        <span class="c1"># if &#39;velocity&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;velocity&#39;] = kwargs[&#39;velocity&#39;]</span>
        <span class="c1"># if &#39;los_count&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;los_count&#39;] = kwargs[&#39;los_count&#39;]</span>
        <span class="c1"># if &#39;log&#39; in kwarg_keys:</span>
        <span class="c1">#     self.files[&#39;log&#39;] = kwargs[&#39;log&#39;]</span>
        
        <span class="c1"># Load all model data (can be expensive for memory)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensity_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">])</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_positions</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">intensity_species</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">intensity_dust</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intensity_file</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;optical_depth&#39;</span><span class="p">])</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_species</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_dust</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_file</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_vox_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;f_vox&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_vox_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_intensity_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;hi_intensity&#39;</span><span class="p">])</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_map_positions</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">hi_intensity_species</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">hi_intensity_dust</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_intensity_file</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;hi_optical_depth&#39;</span><span class="p">])</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_species</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_dust</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_file</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dust_absorption_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;dust_absorption&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dust_absorption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust_absorption_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dust_emissivity_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;dust_emissivity&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dust_emissivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust_emissivity_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_absorption_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;species_absorption&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_absorption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_absorption_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_emissivity_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;species_emissivity&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_emissivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_emissivity_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_absorption_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;hi_absorption&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_absorption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_absorption_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_emissivity_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;hi_emissivity&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_emissivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_emissivity_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_number_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;species_number&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_number_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_gas_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;t_gas&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_gas_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_dust_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;t_dust&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_dust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_dust_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clump_number_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;clump_number&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clump_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clump_number_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clump_radius_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;clump_radius&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clump_radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clump_radius_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">density_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_dispersion_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;ensemble_dispersion&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_dispersion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_dispersion_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;ensemble_mass&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_mass_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;hi_mass&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hi_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_mass_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h2_mass_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;h2_mass&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h2_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h2_mass_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuv_absorption_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;fuv_absorption&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuv_absorption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuv_absorption_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuv_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;fuv&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuv_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocity_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;velocity&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hdul_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">los_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;los_count&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">])</span>
        
        <span class="c1"># Extract headers and create additional axes</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_absorption_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_absorption_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;COMMENT&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>   <span class="c1">#position of voxel size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;N/A&#39;&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_number_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">N_species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_number_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SPECIES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">N_species</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intensity_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_file</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_file</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;BUNIT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_file</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;BUNIT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> \
                                           <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_file</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;BUNIT&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dust_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_file</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dust_header</span><span class="p">[</span><span class="s1">&#39;BUNIT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_file</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;BUNIT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> \
                                        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_file</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;BUNIT&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;SPECIES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dust</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust_header</span><span class="p">[</span><span class="s1">&#39;DUST&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dust_header</span><span class="p">[</span><span class="s1">&#39;BUNIT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_file</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;BUNIT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> \
                                        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_file</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;BUNIT&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CRVAL2&#39;</span><span class="p">]</span> 
                                       <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CDELT2&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CRPIX2&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span> 
                                       <span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CRVAL2&#39;</span><span class="p">]</span> 
                                       <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CDELT2&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;NAXIS2&#39;</span><span class="p">]</span>
                                                                        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CRPIX2&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span> 
                                       <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;NAXIS2&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CRVAL3&#39;</span><span class="p">]</span> 
                                       <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CDELT3&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CRPIX3&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span> 
                                       <span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CRVAL3&#39;</span><span class="p">]</span> 
                                       <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CDELT3&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;NAXIS3&#39;</span><span class="p">]</span>
                                                                        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CRPIX3&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span> 
                                       <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;NAXIS3&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CRVAL4&#39;</span><span class="p">]</span> 
                                       <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CDELT4&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CRPIX4&#39;</span><span class="p">]),</span> 
                                       <span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CRVAL4&#39;</span><span class="p">]</span> 
                                       <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CDELT4&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;NAXIS4&#39;</span><span class="p">]</span>
                                                                        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;CRPIX4&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> 
                                       <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species_header</span><span class="p">[</span><span class="s1">&#39;NAXIS4&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_header</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dust_header</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        
        <span class="c1"># convert from radians to degrees if specified</span>
        <span class="c1"># (rounding removes floating point error)</span>
        <span class="k">if</span> <span class="n">map_units</span> <span class="o">==</span> <span class="s1">&#39;deg&#39;</span> <span class="ow">or</span> <span class="n">map_units</span> <span class="o">==</span> <span class="s1">&#39;degrees&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_lon</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_lat</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="k">return</span>

<div class="viewcode-block" id="SyntheticModel.get_dust_wavelengths">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_dust_wavelengths">[docs]</a>
    <span class="k">def</span> <span class="nf">get_dust_wavelengths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return dust wavelengths used in model.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">wav</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">wav</span><span class="p">])</span></div>


<div class="viewcode-block" id="SyntheticModel.get_volume_filling_factor">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_volume_filling_factor">[docs]</a>
    <span class="k">def</span> <span class="nf">get_volume_filling_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return volume filling factor data.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clump_number</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clump_radius</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">clump_number</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">clump_radius</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">**</span><span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span></div>


<div class="viewcode-block" id="SyntheticModel.get_species_number">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_species_number">[docs]</a>
    <span class="k">def</span> <span class="nf">get_species_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">abun</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nref</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;H2&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span> <span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return species number data. This is the number of a given species contained in each voxel.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]:</span>
            <span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_species</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">abun</span><span class="p">:</span>
            <span class="n">N_0</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">nref</span><span class="p">:</span>
                <span class="n">N_0</span> <span class="o">+=</span> <span class="n">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_number</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sp</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N_0</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">N_species</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span>
            <span class="n">N_species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_number</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span><span class="o">/</span><span class="n">N_0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">N_species</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">total</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">N_species</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">N_species</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">N_species</span></div>


<div class="viewcode-block" id="SyntheticModel.get_abundances">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_abundances">[docs]</a>
    <span class="k">def</span> <span class="nf">get_abundances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return species abundance data.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_species_number</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">abun</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="SyntheticModel.get_gas_temperature">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_gas_temperature">[docs]</a>
    <span class="k">def</span> <span class="nf">get_gas_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return gas temperature data.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">total</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t_gas</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_gas</span><span class="p">)</span></div>


<div class="viewcode-block" id="SyntheticModel.get_dust_temperature">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_dust_temperature">[docs]</a>
    <span class="k">def</span> <span class="nf">get_dust_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return dust temperature data.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">total</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">t_dust</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_dust</span><span class="p">)</span></div>


<div class="viewcode-block" id="SyntheticModel.get_model_species_emissivity">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_model_species_emissivity">[docs]</a>
    <span class="k">def</span> <span class="nf">get_model_species_emissivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return species emissivity in model (ie. for each voxel).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">transition</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">transition</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">transition</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter a valid value for transition or idx&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">emissivity</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">include_dust</span><span class="p">:</span>
                <span class="n">emissivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_emissivity</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if len(self.dust) &gt; 10:</span>
                <span class="c1">#     wav_dust = self.get_emissivity_wavelengths()</span>
                <span class="c1">#     f = interp1d(self.emissivity_dust, wav_dust, axis=2, kind=&#39;slinear&#39;, </span>
                <span class="c1">#                  fill_value=&#39;extrapolate&#39;)</span>
                <span class="c1">#     emissivity_dust = f(wav_species[i])</span>
                <span class="c1"># else:</span>
                <span class="c1">#     emissivity_dust = self.emissivity_dust.mean(2)</span>
                <span class="n">emissivity_dust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_emissivity</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">emissivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_emissivity</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">emissivity_dust</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">emissivity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">emissivity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">emissivity</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="SyntheticModel.get_model_species_absorption">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_model_species_absorption">[docs]</a>
    <span class="k">def</span> <span class="nf">get_model_species_absorption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return species absorption in model (ie. for each voxel).</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">transition</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">transition</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">transition</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter a valid value for transition or idx&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">absorption</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">include_dust</span><span class="p">:</span>
                <span class="n">absorption</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_absorption</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if len(self.dust) &gt; 10:</span>
                <span class="c1">#     wav_dust = self.get_absorption_wavelengths()</span>
                <span class="c1">#     f = interp1d(self.absorption_dust, wav_dust, axis=2, kind=&#39;slinear&#39;, </span>
                <span class="c1">#                  fill_value=&#39;extrapolate&#39;)</span>
                <span class="c1">#     absorption_dust = f(wav_species[i])</span>
                <span class="c1"># else:</span>
                <span class="c1">#     absorption_dust = self.absorption_dust.mean(2)</span>
                <span class="n">absorption_dust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_absorption</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">absorption</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_absorption</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">absorption_dust</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">absorption</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">absorption</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">absorption</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="SyntheticModel.get_model_species_intensity">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_model_species_intensity">[docs]</a>
    <span class="k">def</span> <span class="nf">get_model_species_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">integrated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return species intensity in model (ie. for each voxel).</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_emissivity</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="n">transition</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span>
        <span class="n">kap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_absorption</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="n">transition</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
        <span class="n">i_nan</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">intensity</span><span class="p">[</span><span class="o">~</span><span class="n">i_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="o">~</span><span class="n">i_nan</span><span class="p">]</span><span class="o">/</span><span class="n">kap</span><span class="p">[</span><span class="o">~</span><span class="n">i_nan</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">kap</span><span class="p">[</span><span class="o">~</span><span class="n">i_nan</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">))</span>
        <span class="n">intensity</span><span class="p">[</span><span class="n">i_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="n">i_nan</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">integrated</span> <span class="ow">and</span> <span class="p">(</span><span class="n">intensity</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_vel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">integrated</span> <span class="ow">and</span> <span class="p">(</span><span class="n">intensity</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_vel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span></div>


<div class="viewcode-block" id="SyntheticModel.get_model_hi_emissivity">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_model_hi_emissivity">[docs]</a>
    <span class="k">def</span> <span class="nf">get_model_hi_emissivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return HI 21cm line emissivity in model (ie. for each voxel).</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">include_dust</span><span class="p">:</span>
            <span class="n">emissivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_emissivity</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if len(self.dust) &gt; 10:</span>
            <span class="c1">#     wav_dust = self.get_dust_wavelengths()</span>
            <span class="c1">#     f = interp1d(self.dust_emissivity, wav_dust, axis=2, kind=&#39;slinear&#39;, </span>
            <span class="c1">#                  fill_value=&#39;extrapolate&#39;)</span>
            <span class="c1">#     emissivity_dust = f(wav_species[i])</span>
            <span class="c1"># else:</span>
            <span class="c1">#     emissivity_dust = self.emissivity_dust.mean(2)</span>
            <span class="n">emissivity_dust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_emissivity</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">emissivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_emissivity</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">emissivity_dust</span>

        <span class="k">return</span> <span class="n">emissivity</span></div>


<div class="viewcode-block" id="SyntheticModel.get_model_hi_absorption">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_model_hi_absorption">[docs]</a>
    <span class="k">def</span> <span class="nf">get_model_hi_absorption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return HI 21cm line absorption in model (ie. for each voxel).</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">include_dust</span><span class="p">:</span>
            <span class="n">absorption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_absorption</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if len(self.dust) &gt; 10:</span>
            <span class="c1">#     wav_dust = self.get_dust_wavelengths()</span>
            <span class="c1">#     f = interp1d(self.dust_absorption, wav_dust, axis=2, kind=&#39;slinear&#39;, </span>
            <span class="c1">#                  fill_value=&#39;extrapolate&#39;)</span>
            <span class="c1">#     absorption_dust = f(wav_species[i])</span>
            <span class="c1"># else:</span>
            <span class="c1">#     absorption_dust = self.absorption_dust.mean(2)</span>
            <span class="n">absorption_dust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_absorption</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">absorption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_absorption</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">absorption_dust</span>

        <span class="k">return</span> <span class="n">absorption</span></div>


<div class="viewcode-block" id="SyntheticModel.get_model_hi_intensity">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_model_hi_intensity">[docs]</a>
    <span class="k">def</span> <span class="nf">get_model_hi_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">integrated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return HI 21cm line emissivity in model (ie. for each voxel).</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_hi_emissivity</span><span class="p">(</span><span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span>
        <span class="n">kap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_hi_absorption</span><span class="p">(</span><span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
        <span class="n">i_nan</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">intensity</span><span class="p">[</span><span class="o">~</span><span class="n">i_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="o">~</span><span class="n">i_nan</span><span class="p">]</span><span class="o">/</span><span class="n">kap</span><span class="p">[</span><span class="o">~</span><span class="n">i_nan</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">kap</span><span class="p">[</span><span class="o">~</span><span class="n">i_nan</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">))</span>
        <span class="n">intensity</span><span class="p">[</span><span class="n">i_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="n">i_nan</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">intensity</span></div>


<div class="viewcode-block" id="SyntheticModel.get_model_dust_emissivity">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_model_dust_emissivity">[docs]</a>
    <span class="k">def</span> <span class="nf">get_model_dust_emissivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return dust emissivity in model (ie. for each voxel).</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">wavelength</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">wavelength</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">wavelength</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">wavelength</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter a valid value for wavelength or idx&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">emissivity</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
            <span class="n">emissivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust_emissivity</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">emissivity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">emissivity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">emissivity</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="SyntheticModel.get_model_dust_absorption">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_model_dust_absorption">[docs]</a>
    <span class="k">def</span> <span class="nf">get_model_dust_absorption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return dust absorption in model (ie. for each voxel).</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">wavelength</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">wavelength</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">wavelength</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">wavelength</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter a valid value for wavelength or idx&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">absorption</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
            <span class="n">absorption</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust_absorption</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">absorption</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">absorption</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">absorption</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="SyntheticModel.get_model_dust_intensity">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_model_dust_intensity">[docs]</a>
    <span class="k">def</span> <span class="nf">get_model_dust_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return dust intensity in model (ie. for each voxel).</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_dust_emissivity</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">kap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_dust_absorption</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
        <span class="n">i_nan</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">intensity</span><span class="p">[</span><span class="o">~</span><span class="n">i_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="o">~</span><span class="n">i_nan</span><span class="p">]</span><span class="o">/</span><span class="n">kap</span><span class="p">[</span><span class="o">~</span><span class="n">i_nan</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">kap</span><span class="p">[</span><span class="o">~</span><span class="n">i_nan</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">))</span>
        <span class="n">intensity</span><span class="p">[</span><span class="n">i_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="n">i_nan</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span></div>


<div class="viewcode-block" id="SyntheticModel.get_species_intensity">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_species_intensity">[docs]</a>
    <span class="k">def</span> <span class="nf">get_species_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">integrated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return species intensity in synthetic observation.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">transition</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">transition</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">transition</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter a valid value for transition or idx&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">intensity</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">include_dust</span><span class="p">:</span>
                <span class="n">intensity_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_species</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if len(self.dust) &gt; 10:</span>
                <span class="c1">#     wav_dust = self.get_dust_wavelengths()</span>
                <span class="c1">#     f = interp1d(self.intensity_dust, wav_dust, axis=2, kind=&#39;slinear&#39;, </span>
                <span class="c1">#                  fill_value=&#39;extrapolate&#39;)</span>
                <span class="c1">#     intensity_dust = f(wav_species[i])</span>
                <span class="c1"># else:</span>
                <span class="c1">#     intensity_dust = self.intensity_dust.mean(2)</span>
                <span class="n">intensity_dust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_species</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">intensity_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_species</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">intensity_dust</span>
            <span class="k">if</span> <span class="n">integrated</span><span class="p">:</span>
                <span class="n">intensity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">intensity_temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_vel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">intensity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">intensity_temp</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intensity</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="SyntheticModel.get_species_optical_depth">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_species_optical_depth">[docs]</a>
    <span class="k">def</span> <span class="nf">get_species_optical_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return species optical depth in synthetic observation.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">transition</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">transition</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">transition</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter a valid value for transition or idx&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">optical_depth</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">include_dust</span><span class="p">:</span>
                <span class="n">optical_depth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_species</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if len(self.dust) &gt; 10:</span>
                <span class="c1">#     wav_dust = self.get_dust_wavelengths()</span>
                <span class="c1">#     f = interp1d(self.optical_depth_dust, wav_dust, axis=2, kind=&#39;slinear&#39;, </span>
                <span class="c1">#                  fill_value=&#39;extrapolate&#39;)</span>
                <span class="c1">#     optical_depth_dust = f(wav_species[i])</span>
                <span class="c1"># else:</span>
                <span class="c1">#     optical_depth_dust = self.optical_depth_dust.mean(2)</span>
                <span class="n">optical_depth_dust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_species</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">optical_depth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_species</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">optical_depth_dust</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">optical_depth</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optical_depth</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optical_depth</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="SyntheticModel.get_hi_intensity">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_hi_intensity">[docs]</a>
    <span class="k">def</span> <span class="nf">get_hi_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">integrated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return HI 21cm line intensity in synthetic observation.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">include_dust</span><span class="p">:</span>
            <span class="n">intensity_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_intensity_species</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if len(self.dust) &gt; 10:</span>
            <span class="c1">#     wav_dust = self.get_dust_wavelengths()</span>
            <span class="c1">#     f = interp1d(self.intensity_dust, wav_dust, axis=2, kind=&#39;slinear&#39;, </span>
            <span class="c1">#                  fill_value=&#39;extrapolate&#39;)</span>
            <span class="c1">#     intensity_dust = f(wav_species[i])</span>
            <span class="c1"># else:</span>
            <span class="c1">#     intensity_dust = self.intensity_dust.mean(2)</span>
            <span class="n">intensity_dust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_intensity_species</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">intensity_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_intensity_species</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">intensity_dust</span>
        <span class="k">if</span> <span class="n">integrated</span><span class="p">:</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">intensity_temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_vel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">intensity_temp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">intensity</span></div>


<div class="viewcode-block" id="SyntheticModel.get_hi_optical_depth">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_hi_optical_depth">[docs]</a>
    <span class="k">def</span> <span class="nf">get_hi_optical_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return HI 21cm line optical depth in synthetic observation.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">include_dust</span><span class="p">:</span>
            <span class="n">optical_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_species</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if len(self.dust) &gt; 10:</span>
            <span class="c1">#     wav_dust = self.get_dust_wavelengths()</span>
            <span class="c1">#     f = interp1d(self.intensity_dust, wav_dust, axis=2, kind=&#39;slinear&#39;, </span>
            <span class="c1">#                  fill_value=&#39;extrapolate&#39;)</span>
            <span class="c1">#     intensity_dust = f(wav_species[i])</span>
            <span class="c1"># else:</span>
            <span class="c1">#     intensity_dust = self.intensity_dust.mean(2)</span>
            <span class="n">optical_depth_dust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_species</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">optical_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_optical_depth_species</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">optical_depth_dust</span>

        <span class="k">return</span> <span class="n">optical_depth</span></div>


<div class="viewcode-block" id="SyntheticModel.get_dust_intensity">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_dust_intensity">[docs]</a>
    <span class="k">def</span> <span class="nf">get_dust_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return dust intensity in synthetic observation.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">wavelength</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">wavelength</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">wavelength</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">wavelength</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter a valid value for wavelength or idx&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">intensity</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
            <span class="n">intensity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intensity_dust</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intensity</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="SyntheticModel.get_dust_optical_depth">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.get_dust_optical_depth">[docs]</a>
    <span class="k">def</span> <span class="nf">get_dust_optical_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return dust optical depth in synthetic observation.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">wavelength</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">wavelength</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">wavelength</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">:</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">wavelength</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter a valid value for wavelength or idx&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">optical_depth</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
            <span class="n">optical_depth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optical_depth_dust</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">optical_depth</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optical_depth</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optical_depth</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="SyntheticModel.plot_model_quantity">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.plot_model_quantity">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_model_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transition2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ens</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                            <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">integrated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                            <span class="n">cmap_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="mi">27</span><span class="p">},</span>
                            <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">label_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a 3DAxes with the specitied quantity shown in the colour scale.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.usetex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Nimbus Roman&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.fontset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;stix&#39;</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">cmap_kwargs</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cbar&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">cbar_kwargs</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">quantity</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please specify a property to plot&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;intensity&#39;</span> <span class="ow">and</span> <span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="c1"># transition2 = transition[1]</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="n">transition</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_intensity</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="n">transition</span><span class="p">,</span> 
                                                     <span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">,</span> 
                                                     <span class="n">integrated</span><span class="o">=</span><span class="n">integrated</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">integrated</span><span class="p">:</span>
                <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\varpi_\nu$ (K km s$^{-1}$)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I_\nu$ (K)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;emissivity&#39;</span> <span class="ow">and</span> <span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_emissivity</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">==</span><span class="n">transition</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\epsilon_\nu$ (K pc$^{-1}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;absorption&#39;</span> <span class="ow">and</span> <span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_absorption</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">==</span><span class="n">transition</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\kappa_\nu$ (pc$^{-1}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;intensity&#39;</span> <span class="ow">and</span> <span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">:</span>
            <span class="c1"># transition2 = transition[1]</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="n">transition</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_dust_intensity</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="n">transition</span><span class="p">)</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I_\nu$ (K)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;emissivity&#39;</span> <span class="ow">and</span> <span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust_emissivity</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="o">==</span><span class="n">transition</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\epsilon_\nu$ (K pc$^{-1}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;absorption&#39;</span> <span class="ow">and</span> <span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust_absorption</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="o">==</span><span class="n">transition</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\kappa_\nu$ (pc$^{-1}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;intensity&#39;</span> <span class="ow">and</span> <span class="n">transition</span> <span class="o">==</span> <span class="s1">&#39;HI&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_model</span><span class="p">:</span>
            <span class="c1"># transition2 = transition[1]</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="n">transition</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_hi_intensity</span><span class="p">(</span><span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">,</span> 
                                                <span class="n">integrated</span><span class="o">=</span><span class="n">integrated</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">integrated</span><span class="p">:</span>
                <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\varpi_\nu$ (K km s$^{-1}$)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I_\nu$ (K)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;emissivity&#39;</span> <span class="ow">and</span> <span class="n">transition</span> <span class="o">==</span> <span class="s1">&#39;HI&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_model</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_emissivity</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\epsilon_\nu$ (K pc$^{-1}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;absorption&#39;</span> <span class="ow">and</span> <span class="n">transition</span> <span class="o">==</span> <span class="s1">&#39;HI&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_model</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_absorption</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\kappa_\nu$ (pc$^{-1}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;FUV&#39;</span> <span class="ow">or</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;fuv&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ens</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuv</span><span class="p">[:,</span> <span class="n">ens</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\chi$ ($\chi_\mathrm</span><span class="si">{D}</span><span class="s1">$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ens</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">[:,</span> <span class="n">ens</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$n_\mathrm</span><span class="si">{ens}</span><span class="s1">$ (cm$^{-3}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;dispersion&#39;</span> <span class="ow">or</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;sigma&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ens</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_dispersion</span><span class="p">[:,</span> <span class="n">ens</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_dispersion</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\sigma_\mathrm</span><span class="si">{ens}</span><span class="s1">$ (km s$^{-1}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;t_gas&#39;</span><span class="p">,</span> <span class="s1">&#39;gas temperature&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ens</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_gas_temperature</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:,</span> <span class="n">ens</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_gas_temperature</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$T_\mathrm</span><span class="si">{gas}</span><span class="s1">$ (K)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;t_dust&#39;</span><span class="p">,</span> <span class="s1">&#39;dust temperature&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ens</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dust_temperature</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:,</span> <span class="n">ens</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dust_temperature</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$T_\mathrm</span><span class="si">{dust}</span><span class="s1">$ (K)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;f_vox&#39;</span> <span class="ow">or</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;voxel-filling factor&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$f_\mathrm</span><span class="si">{vox}</span><span class="s1">$&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;f_vol&#39;</span> <span class="ow">or</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;volume-filling factor&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_volume_filling_factor</span><span class="p">()</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$f_\mathrm</span><span class="si">{voxel}</span><span class="s1">$&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;m_h&#39;</span> <span class="ow">or</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;atomic mass&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ens</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_mass</span><span class="p">[:,</span> <span class="n">ens</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_mass</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$M_\mathrm{H^0}$ ($M_\odot$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;m_h2&#39;</span> <span class="ow">or</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;molecular mass&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ens</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2_mass</span><span class="p">[:,</span> <span class="n">ens</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2_mass</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$M_\mathrm{H^2}$ ($M_\odot$)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Quantity not available.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;intensity&#39;</span> <span class="ow">and</span> <span class="n">transition2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="c1"># transition2 = transition[1]</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="n">transition</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_intensity</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="n">transition2</span><span class="p">,</span> 
                                                      <span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">,</span> 
                                                      <span class="n">integrated</span><span class="o">=</span><span class="n">integrated</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">integrated</span><span class="p">:</span>
                <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\varpi_\nu$ ratio (K km s$^{-1}$)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I_\nu$ ratio (K)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;emissivity&#39;</span> <span class="ow">and</span> <span class="n">transition2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_emissivity</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">==</span><span class="n">transition2</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\epsilon_\nu$ ratio (K pc$^{-1}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;absorption&#39;</span> <span class="ow">and</span> <span class="n">transition2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_absorption</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">==</span><span class="n">transition2</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\kappa_\nu$ ratio (pc$^{-1}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;intensity&#39;</span> <span class="ow">and</span> <span class="n">transition2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">:</span>
            <span class="c1"># transition2 = transition[1]</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="n">transition</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_dust_intensity</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="n">transition2</span><span class="p">)</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I_\nu$ ratio (K)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;emissivity&#39;</span> <span class="ow">and</span> <span class="n">transition2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">:</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust_emissivity</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="o">==</span><span class="n">transition2</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\epsilon_\nu$ ratio (K pc$^{-1}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;absorption&#39;</span> <span class="ow">and</span> <span class="n">transition2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">:</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust_absorption</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="o">==</span><span class="n">transition2</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\kappa_\nu$ ratio (pc$^{-1}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;intensity&#39;</span> <span class="ow">and</span> <span class="n">transition2</span> <span class="o">==</span> <span class="s1">&#39;HI&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_model</span><span class="p">:</span>
            <span class="c1"># transition2 = transition[1]</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="n">transition</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_hi_intensity</span><span class="p">(</span><span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">,</span> 
                                                 <span class="n">integrated</span><span class="o">=</span><span class="n">integrated</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">integrated</span><span class="p">:</span>
                <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\varpi_\nu$ ratio (K km s$^{-1}$)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I_\nu$ ratio (K)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;emissivity&#39;</span> <span class="ow">and</span> <span class="n">transition2</span> <span class="o">==</span> <span class="s1">&#39;HI&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_model</span><span class="p">:</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_emissivity</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\epsilon_\nu$ ratio (K pc$^{-1}$)&#39;</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;absorption&#39;</span> <span class="ow">and</span> <span class="n">transition2</span> <span class="o">==</span> <span class="s1">&#39;HI&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_model</span><span class="p">:</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_absorption</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\kappa_\nu$ ratio (pc$^{-1}$)&#39;</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">quantity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;emissivity&#39;</span><span class="p">,</span> <span class="s1">&#39;absorption&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;intensity&#39;</span> <span class="ow">and</span> <span class="n">integrated</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">))</span> \
            <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">stat</span> <span class="o">==</span> <span class="s1">&#39;std&#39;</span> <span class="ow">or</span> <span class="n">stat</span> <span class="o">==</span> <span class="s1">&#39;sigma&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">transition2</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="n">value2</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">stat</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">transition2</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="n">value2</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">stat</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">transition2</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="n">value2</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">stat</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">transition2</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="n">value2</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s1"> not available&#39;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;intensity&#39;</span> <span class="ow">and</span> <span class="n">integrated</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">transition2</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="n">value2</span>

        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">clabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;log$_</span><span class="si">{10}</span><span class="s1">$ &#39;</span> <span class="o">+</span> <span class="n">clabel</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">T</span>
        <span class="n">lims</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

        <span class="n">cm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="o">**</span><span class="n">cmap_kwargs</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="o">**</span><span class="n">cbar_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label_axes</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X (kpc)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y (kpc)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z (kpc)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">clabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lims</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lims</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">lims</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="mi">270</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="SyntheticModel.radial_plot">
<a class="viewcode-back" href="../../../_autosummary/kosmatau3d.models.model.SyntheticModel.html#kosmatau3d.models.model.SyntheticModel.radial_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">radial_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;intensity&#39;</span><span class="p">,</span> <span class="n">transition</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CO 1&#39;</span><span class="p">],</span> <span class="n">transition2</span><span class="o">=</span><span class="p">[],</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                    <span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">integrated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">normalized</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                    <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:maroon&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span> 
                    <span class="n">legendsize</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span> <span class="n">legendloc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                    <span class="n">bins</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span> <span class="n">bin_lim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18000</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">voxel_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot a given quantity as a function of galactocentric radius.</span>
<span class="sd">        This is only valid for galaxy models of type &#39;disk&#39;.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.usetex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Nimbus Roman&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.fontset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;stix&#39;</span>

        <span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
        <span class="n">rgal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

        <span class="n">i_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_lat</span> <span class="o">==</span> <span class="n">lat</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">bin_lim</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
        <span class="n">bins_mid</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">/</span><span class="mi">2</span>

        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">quantity</span>
        
        <span class="k">if</span> <span class="n">scale</span><span class="p">:</span>
            <span class="n">f_vox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f_vox</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">,</span> <span class="s1">&#39;optical depth&#39;</span><span class="p">,</span> <span class="s1">&#39;emissivity&#39;</span><span class="p">,</span> <span class="s1">&#39;absorption&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">transition</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;HI&#39;</span><span class="p">:</span>
                    <span class="n">eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_hi_emissivity</span><span class="p">(</span><span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_vox</span>
                    <span class="n">kap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_hi_absorption</span><span class="p">(</span><span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_vox</span>
                    <span class="n">tau</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span>
                    <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_hi_intensity</span><span class="p">(</span><span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_vox</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_emissivity</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_vox</span>
                    <span class="n">kap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_absorption</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_vox</span>
                    <span class="n">tau</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span>
                    <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_intensity</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_vox</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">transition2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">transition2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;HI&#39;</span><span class="p">:</span>
                        <span class="n">eps2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_hi_emissivity</span><span class="p">(</span><span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_vox</span>
                        <span class="n">kap2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_hi_absorption</span><span class="p">(</span><span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_vox</span>
                        <span class="n">tau2</span> <span class="o">=</span> <span class="n">kap2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span>
                        <span class="n">intensity2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_hi_intensity</span><span class="p">(</span><span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_vox</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">eps2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_emissivity</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="n">transition2</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_vox</span>
                        <span class="n">kap2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_absorption</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="n">transition2</span><span class="p">,</span> <span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_vox</span>
                        <span class="n">tau2</span> <span class="o">=</span> <span class="n">kap2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span>
                        <span class="n">intensity2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_intensity</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="n">transition2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span> <span class="n">f_vox</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eps2</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">kap2</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">intensity2</span> <span class="o">=</span> <span class="kc">None</span>
                
                <span class="c1"># intensity = eps/kap * (1-np.exp(-kap*self.ds))</span>
                
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">transition2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;emissivity&#39;</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\epsilon$ (K pc$^{-1}$ kpc$^{-1}$)&#39;</span>
                    <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;absorption&#39;</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">kap</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\kappa$ (pc$^{-1}$ kpc$^{-1}$)&#39;</span>
                    <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;optical depth&#39;</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">tau</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\tau$ (kpc$^{-1}$)&#39;</span>
                    <span class="k">elif</span> <span class="n">integrated</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_vel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$W$ (K km s$^{-1}$ kpc$^{-1}$)&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">intensity</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$I$ (K kpc$^{-1}$)&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;emissivity&#39;</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">eps2</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_\epsilon$ (K pc$^{-1}$ kpc$^{-1}$)&#39;</span>
                    <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;absorption&#39;</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">kap</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">kap2</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_\kappa$ (pc$^{-1}$ kpc$^{-1}$)&#39;</span>
                    <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;optical depth&#39;</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">tau</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">tau2</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_\tau$ (kpc$^{-1}$)&#39;</span>
                    <span class="k">elif</span> <span class="n">integrated</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_vel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">intensity2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_vel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_W$ (K km s$^{-1}$ kpc$^{-1}$)&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">intensity</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">intensity2</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_I$ (K kpc$^{-1}$)&#39;</span>

                <span class="k">if</span> <span class="n">voxel_size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39; kpc$^{-1}$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">voxel_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">voxel_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">/</span><span class="mf">1e3</span>

                <span class="n">value_stat</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">rgal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins_mid</span><span class="p">,</span> <span class="n">value_stat</span><span class="o">/</span><span class="n">voxel_size</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">legendsize</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">legendloc</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$R_\mathrm</span><span class="si">{gal}</span><span class="s1">$ (kpc)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ax</span>

        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;mass&#39;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$M_\mathrm</span><span class="si">{ens}</span><span class="s1">$ (M$_\odot$ kpc$^{-1}$)&#39;</span>
            <span class="c1">#for idx in range(self.ensemble_mass.shape[1]):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">f_vox</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">value_stat</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">rgal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ens 0 mass&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">bins_mid</span><span class="p">,</span> <span class="n">value_stat</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">f_vox</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">value_stat</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">rgal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ens 1 mass&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">bins_mid</span><span class="p">,</span> <span class="n">value_stat</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">f_vox</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_mass</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">value_stat</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">rgal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;H mass&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">bins_mid</span><span class="p">,</span> <span class="n">value_stat</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">f_vox</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2_mass</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">value_stat</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">rgal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;H2 mass&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">bins_mid</span><span class="p">,</span> <span class="n">value_stat</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$R_\mathrm</span><span class="si">{gal}</span><span class="s1">$ (kpc)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ax</span>

        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;ensemble mass&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">label_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; total&#39;</span><span class="p">,</span> <span class="s1">&#39; clump&#39;</span><span class="p">,</span> <span class="s1">&#39; interclump&#39;</span><span class="p">]</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_vox</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_vox</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_vox</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_mass</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$M_\mathrm</span><span class="si">{ens}</span><span class="s1">$ (M$_\odot$ kpc$^{-1}$)&#39;</span>

        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;hi mass&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">label_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; total&#39;</span><span class="p">,</span> <span class="s1">&#39; clump&#39;</span><span class="p">,</span> <span class="s1">&#39; interclump&#39;</span><span class="p">]</span>
            <span class="n">mass_cl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_mass</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_mass</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">f_vox_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">mass_int</span> <span class="o">=</span> <span class="n">f_vox_int</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi_mass</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_mass</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f_vox_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">mass_int</span> <span class="o">=</span> <span class="n">f_vox_int</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_mass</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass_cl</span> <span class="o">+</span> <span class="n">mass_int</span><span class="p">)</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass_cl</span><span class="p">)</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass_int</span><span class="p">)</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$M_\mathrm{H^0}$ (M$_\odot$ kpc$^{-1}$)&#39;</span>

        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;h2 mass&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">label_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; total&#39;</span><span class="p">,</span> <span class="s1">&#39; clump&#39;</span><span class="p">,</span> <span class="s1">&#39; interclump&#39;</span><span class="p">]</span>
            <span class="n">mass_cl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2_mass</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_mass</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">f_vox_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">mass_int</span> <span class="o">=</span> <span class="n">f_vox_int</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h2_mass</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2_mass</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f_vox_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">mass_int</span> <span class="o">=</span> <span class="n">f_vox_int</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2_mass</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass_cl</span> <span class="o">+</span> <span class="n">mass_int</span><span class="p">)</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass_cl</span><span class="p">)</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass_int</span><span class="p">)</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$M_\mathrm</span><span class="si">{H_2}</span><span class="s1">$ (M$_\odot$ kpc$^{-1}$)&#39;</span>

        <span class="k">elif</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;X_CO&#39;</span><span class="p">,</span> <span class="s1">&#39;Xco&#39;</span><span class="p">,</span> <span class="s1">&#39;xco&#39;</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_species_number</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="s1">&#39;H2&#39;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">*</span><span class="n">constants</span><span class="o">.</span><span class="n">pc</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> \
                    <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_intensity</span><span class="p">(</span><span class="n">include_dust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">integrated</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">transition</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">:]</span> \
                    <span class="o">/</span> <span class="mf">2e20</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$X_\mathrm</span><span class="si">{CO}</span><span class="s1">$ / $X_\mathrm{CO, MW}$&#39;</span>

        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;ensemble density&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$n_\mathrm{ens, &#39;</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;}$ (cm$^{-3}$ kpc$^{-1}$)&#39;</span>

        <span class="k">elif</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;R_sa&#39;</span><span class="p">,</span> <span class="s1">&#39;r_sa&#39;</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_emissivity</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="n">transition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)</span> <span class="o">/</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">get_model_species_intensity</span><span class="p">(</span><span class="n">transition</span><span class="o">=</span><span class="n">transition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">include_dust</span><span class="o">=</span><span class="n">include_dust</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_\mathrm{&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">transition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}$&#39;</span>

        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;ensemble FUV&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuv</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\chi$ ($\chi_\mathrm</span><span class="si">{D}</span><span class="s1">$)&#39;</span>

        <span class="k">elif</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fvox&#39;</span><span class="p">,</span> <span class="s1">&#39;f_vox&#39;</span><span class="p">]:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$f_\mathrm</span><span class="si">{vox}</span><span class="s1">$&#39;</span>
            
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">value_stat</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">rgal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;H$_\mathrm</span><span class="si">{2}</span><span class="s1">$&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins_mid</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">value_stat</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:sapphire&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_vox</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">value_stat</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">rgal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;H$^\mathrm</span><span class="si">{0}</span><span class="s1">$&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins_mid</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">value_stat</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:maroon&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$R_\mathrm</span><span class="si">{gal}</span><span class="s1">$ (kpc)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ax</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;quantity </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s1"> not available...&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\mathrm</span><span class="si">{log}</span><span class="s1">_</span><span class="si">{10}</span><span class="s1">$ &#39;</span> <span class="o">+</span> <span class="n">ylabel</span>

        <span class="k">if</span> <span class="n">normalized</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">/</span><span class="mf">1e3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s1">&#39;mass&#39;</span> <span class="ow">in</span> <span class="n">quantity</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">value_stat</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">rgal</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins_mid</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">value_stat</span><span class="o">/</span><span class="n">factor</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="o">+</span><span class="n">label_suffix</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_stat</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">rgal</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins_mid</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">value_stat</span><span class="o">/</span><span class="n">factor</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">legendsize</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">legendloc</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$R_\mathrm</span><span class="si">{gal}</span><span class="s1">$ (kpc)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span></div>
</div>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Craig Yanitski.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>